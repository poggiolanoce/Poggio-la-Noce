{% extends "_layouts/_commerce" %}

{% set number = craft.request.param('number') %}
{% set order = craft.commerce.orders.number(number).first() %}

{% if not order %}
  {% redirect 'commerce/customer' %}
{% endif %}

{% block main %}
  <div class="row">
    <div class="twelve columns">

      {% if currentUser %}<p><a href="{{ url('commerce/customer') }}">{{ "My Orders" | t }}</a></p>{% endif %}
      <h1>{{ "Order" | t }} #{{ order.number[:7] }}</h1>


      <div class="row">
        <div class="four columns">
          <h4>{{ "Details" | t }}</h4>

          <ul>
            <li><strong>{{ "Customer"|t }}:</strong> {{ order.customer.email }}</li>
            <li><strong>{{ "Total"|t }}:</strong> {{ order.totalPrice|currency(order.currency) }}</li>
            <li><strong>{{ "Date"|t }}:</strong> {{ order.dateOrdered }}</li>
          </ul>

        </div>
        <div class="four columns">
          <h4>{{ "Shipping Address" | t }}</h4>

          {% if order.shippingAddress %}
          {% include 'commerce/_includes/addresses/address' with { address: order.shippingAddress } %}
          {% endif %}
        </div>
        <div class="four columns">
          <h4>{{ "Billing Address" | t }}</h4>
          {% if order.billingAddress %}
          {% include 'commerce/_includes/addresses/address' with { address: order.billingAddress } %}
          {% endif %}
        </div>
      </div>


      {% if order.pdfUrl %}
      <h4>{{ "Receipt" | t }} (<a href="{{ order.getPdfUrl('receipt') }}">{{ "Download" | t }}</a>)</h4>
      {% endif %}

      <table class="u-full-width">
        <thead>
          <tr>
            <th>{{ "Item" | t }}</th>
            <th>{{ "Unit Price" | t }}</th>
            <th>{{ "Quantity" | t }}</th>
            <th class="text-right">{{ "Total" | t }}</th>
          </tr>
        </thead>
        <tbody>
          {% for item in order.lineItems %}
          <tr>
            <td>
              <strong>{{ item.description }}</strong><br>
              SKU: {{ item.sku }}
            </td>
            <td>
              {% if item.onSale %}
              <strike>{{ item.price|currency(order.currency) }}</strike>   {{ item.salePrice|currency(order.currency) }}
              {% else %}
              {{ item.price|currency(order.currency) }}
              {% endif %}
            </td>
            <td>{{ item.qty }}</td>
            <td class="text-right">{{ item.total|currency(order.currency) }}</td>
          </tr>
          {% endfor %}

          {% for adjustment in order.adjustments %}
          <tr>
            <td>{{ adjustment.type | t }}</td>
            <td colspan="2"><strong>{{ adjustment.name }}</strong></td>
            <td class="text-right">{{ adjustment.amount|currency(order.currency) }}</td>
          </tr>
          {% endfor %}

          <tr>
            <td colspan="4" class="text-right">
              {{ "Item" | t }} {{ "Total" | t }}: {{ order.itemTotal|currency(order.currency) }}<br>
              {% if order.baseDiscount and order.baseDiscount != 0 %}
                {{ "Base" | t }} {{ "Discount" | t }}: {{ order.baseDiscount|currency(order.currency) }}
                <br>
              {% endif %}
              {% if order.totalShippingCost and order.totalShippingCost != 0 %}
                {{ "Total" | t }} {{ "Shipping" | t }}: {{ order.totalShippingCost|currency(order.currency) }}
                <br>
              {% endif %}
              <h4>{{ "Total" | t }}: {{ order.totalPrice|currency(order.currency) }}</h4>
            </td>
          </tr>

        </tbody>
      </table>

    </div>
  </div>
{% endblock %}
