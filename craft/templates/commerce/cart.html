{% extends '_layouts/_layout.html' %}

{% block content %}

  {% include 'partials/flashes.html' %}

  <div class="row">
    <div class="twelve columns">

      {% if cart.lineItems|length %}
      <div class="cart-wrapper">
        <table class="u-full-width">
          <thead>
            <tr>
              <th>{{ "Product" | t }}</th>
              <th>{{ "Qty" | t }}</th>
              <th class="text-right">{{ "Price" | t }}</th>
            </tr>
          </thead>
          <tbody>
            {% for item in cart.lineItems %}
              {% include "commerce/_includes/cart_item" %}
            {% endfor %}
            <tr>
              <td>
                {# Remove all line items to empty the cart: #}
                <form method="POST">
                  <input type="hidden" name="action" value="commerce/cart/removeAllLineItems"/>
                  <input type="hidden" name="redirect" value="commerce/cart"/>
                  {{ getCsrfInput() }}
                  <input class="button link" type="submit" value="{{ "Empty the Cart" | t }}"/>
                  <input type="hidden" name="cartUpdatedNotice" value="Added coupon code.">
                </form>
              </td>
              <td>
              </td>
              <td class="text-right">
                <form method="POST">
                   <input type="hidden" name="action" value="commerce/cart/updateCart">
                   <input type="hidden" name="redirect" value="commerce/cart">
                   <input type="hidden" name="cartUpdatedNotice" value="Added coupon code.">
                   {{ getCsrfInput() }}
                   <span class="{% if cart.getError('couponCode') %}has-error{% endif %}">
                   <input type="text" name="couponCode" class="{% if cart.getError('couponCode') %}has-error{% endif %}" value="{{ cart.couponCode }}" placeholder="{{ "Coupon Code"|t }}">
                   </span>
                   <input type="submit" value="{% if cart.couponCode %}Change{% else %}Apply{% endif %} Coupon"/>
              </form>
                {% if cart.totalDiscount != '0' %}
                  {{ "Total" | t }} {{ "Discount" | t }}: {{ cart.totalDiscount|currency(currencyCode) }}<br>
                  <h4>{{ "Total" | t }}: {{ cart.totalPrice |currency(currencyCode) }}</h4>
                  {% else  %}
                <!-- Use itemPrice because there's no point in adding shipping or taxes before they're selected -->
                <h4>{{ "Total" | t }}: {{ cart.itemSubtotal|currency(currencyCode) }}</h4>
                {% endif %}

              </td>
            </tr>

          </tbody>
        </table>
      </div>

      <div class="checkout-action">
        <a href="{{ url('products') }}" class="return-to-cart">{{ "Back to Wines" | t }}</a>
        <a class="button button-primary" href="{{ url('commerce/checkout') }}">{{ "Checkout" | t }}</a>
      </div>
      {% endif %}

      {% if not cart.lineItems|length %}
        <p class="no-items">{{ 'No Items' | t }} <a href="{{ url('products') }}">{{ 'Products page' | t }}</a>.</p>
      {% endif %}

    </div>
  </div>
{% endblock %}
